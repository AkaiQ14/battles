<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÿ¨ÿØŸàŸÑ ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿßÿ™ - ÿ™ÿ≠ÿØŸä ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑÿ£ŸÜŸÖŸä</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #8B1538;
      --panel: #2d2d2d;
      --panel-light: #3a3a3a;
      --accent: #dc2626;
      --accent-light: #ef4444;
      --text: #ffffff;
      --text-muted: #cccccc;
      --btn: #dc2626;
      --btn-play: #4CAF50;
      --btn-play-hover: #45a049;
      --radius: 12px;
      --radius-large: 16px;
    }
    *{box-sizing: border-box; margin: 0; padding: 0;}
    body{
      font-family: "Cairo", sans-serif;
      background: #8B1538;
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .video-background {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh; z-index: -1;
      object-fit: cover;
      background-image: url('images/QG14Background.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
    .bracket-container {
      background: transparent;
      border-radius: var(--radius-large);
      box-shadow: none;
      padding: 20px 15px 20px 15px;
      width: 100%;
      max-width: 1600px;
      min-height: 400px;
      text-align: center;
      overflow: visible;
    }
    .tournament-header h1 {
      color: white;
      margin-bottom: 15px;
      font-size: 24px;
      font-weight: 800;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.8), 0 0 20px rgba(255,255,255,0.3);
    }
    .tournament-info {
      color: white;
      font-size: 14px;
      margin-bottom: 20px;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
      font-weight: 600;
    }
    /* Bracket Tree Styles - Mirror Horizontal Layout */
    #bracket-content {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 0;
      padding: 25px 15px;
      min-height: 600px;
      max-height: 80vh;
      direction: ltr;
      overflow: visible;
      width: 100%;
      position: relative;
      transform: scale(1.05);
      transform-origin: center center;
    }
    
    .bracket-side {
      display: flex;
      flex-direction: row;
      gap: 50px;
      align-items: center;
    }
    
    .bracket-side.left {
      flex-direction: row-reverse;
    }
    
    .bracket-round {
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      min-height: 550px;
      max-height: 600px;
      min-width: 190px;
      position: relative;
      flex-shrink: 1;
    }
    
    .round-label {
      color: var(--accent);
      font-size: 15px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 14px;
      padding: 7px 12px;
      background: rgba(220, 38, 38, 0.15);
      border-radius: var(--radius);
      border: 2px solid var(--accent);
      box-shadow: 0 2px 10px rgba(220, 38, 38, 0.3);
    }
    
    .match {
      background: rgba(58, 58, 58, 0.9);
      border-radius: var(--radius);
      padding: 0;
      margin: 10px 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
      border: 2px solid rgba(255,255,255,0.2);
      transition: all 0.3s ease;
      width: 190px;
      position: relative;
    }
    
    .match:hover {
      border-color: var(--accent);
      transform: scale(1.05);
      box-shadow: 0 6px 25px rgba(220, 38, 38, 0.6);
    }
    
    .match.completed {
      border-color: var(--btn-play);
      box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4);
    }
    
    .match.current {
      border-color: var(--accent);
      background: rgba(220, 38, 38, 0.2);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { 
        box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); 
      }
      50% { 
        box-shadow: 0 0 20px rgba(220, 38, 38, 0.6); 
      }
    }
    
    .player {
      text-align: center;
      padding: 11px 14px;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      color: white;
    }
    
    .player:last-child {
      border-bottom: none;
    }
    
    .winner {
      background: linear-gradient(135deg, var(--btn-play), var(--btn-play-hover));
      color: #fff;
      font-weight: 800;
    }
    
    .loser {
      text-decoration: line-through;
      color: #888;
      opacity: 0.6;
    }
    
    .vs-text {
      display: none;
    }
    
    /* Connection Lines - Horizontal Style */
    .bracket-side.left .match::after {
      content: '';
      position: absolute;
      left: -25px;
      top: 50%;
      transform: translateY(-50%);
      width: 25px;
      height: 2px;
      background: linear-gradient(90deg, rgba(220, 38, 38, 0.3), var(--accent));
      z-index: -1;
    }
    
    .bracket-side:not(.left) .match::after {
      content: '';
      position: absolute;
      right: -25px;
      top: 50%;
      transform: translateY(-50%);
      width: 25px;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), rgba(220, 38, 38, 0.3));
      z-index: -1;
    }
    
    .bracket-round:last-child .match::after {
      display: none;
    }
    
    /* Final match special styling - Center */
    .bracket-final {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 50px;
    }
    
    .bracket-final .match {
      width: 210px;
      border: 3px solid #f59e0b;
      box-shadow: 0 8px 35px rgba(245, 158, 11, 0.6);
      background: rgba(58, 58, 58, 0.95);
    }
    
    .bracket-final .match:hover {
      transform: scale(1.08);
      box-shadow: 0 10px 45px rgba(245, 158, 11, 0.8);
    }
    
    .bracket-final .round-label {
      border-color: #f59e0b;
      background: rgba(245, 158, 11, 0.2);
      color: #f59e0b;
      font-size: 16px;
      font-weight: 900;
    }
    .play-btn, .result-btn {
      width: 100%;
      border: none;
      padding: 9px;
      font-size: 12px;
      font-family: "Cairo", sans-serif;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 0 0 var(--radius) var(--radius);
    }
    
    .play-btn {
      background: linear-gradient(135deg, var(--btn-play), var(--btn-play-hover));
      color: #fff;
      box-shadow: inset 0 -2px 5px rgba(0,0,0,0.2);
    }
    
    .play-btn:hover {
      background: linear-gradient(135deg, var(--btn-play-hover), var(--btn-play));
      box-shadow: inset 0 -2px 8px rgba(0,0,0,0.3);
    }
    
    .play-btn:disabled {
      background: #666;
      cursor: not-allowed;
      opacity: 0.5;
    }
    
    .result-btn {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: #fff;
      box-shadow: inset 0 -2px 5px rgba(0,0,0,0.2);
    }
    
    .result-btn:hover {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      box-shadow: inset 0 -2px 8px rgba(0,0,0,0.3);
    }
    .final {
      font-size: 24px;
      font-weight: bold;
      color: var(--accent);
      margin-top: 35px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .draw-btn {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      border: 3px solid white;
      border-radius: var(--radius);
      color: #fff;
      padding: 10px 28px;
      font-size: 16px;
      font-family: "Cairo", sans-serif;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 15px;
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5), 0 0 30px rgba(245, 158, 11, 0.3);
    }
    .draw-btn:hover {
      transform: translateY(-3px) scale(1.03);
      box-shadow: 0 8px 25px rgba(255, 152, 0, 0.7), 0 0 40px rgba(245, 158, 11, 0.5);
      border-color: #fbbf24;
    }
    .home-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      border: 3px solid white;
      border-radius: var(--radius);
      color: #fff;
      padding: 10px 24px;
      font-size: 16px;
      font-family: "Cairo", sans-serif;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(220, 38, 38, 0.5), 0 0 30px rgba(220, 38, 38, 0.3);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .home-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(220, 38, 38, 0.7), 0 0 40px rgba(220, 38, 38, 0.5);
      border-color: #fbbf24;
      background: linear-gradient(135deg, #b91c1c, #991b1b);
    }
    .home-btn::before {
      content: 'üè†';
      font-size: 18px;
    }
    @media (max-width: 1600px) {
      #bracket-content {
        transform: scale(0.9);
      }
    }
    
    @media (max-width: 1200px) {
      #bracket-content {
        transform: scale(0.75);
      }
      .bracket-side {
        gap: 35px;
      }
    }
    
    @media (max-width: 768px) {
      .bracket-container {
        max-width: 95vw;
        padding: 15px 5px;
      }
      #bracket-content {
        flex-direction: column;
        gap: 30px;
        min-height: auto;
        transform: scale(1);
        max-height: none;
      }
      .bracket-side {
        flex-direction: row !important;
        gap: 20px;
      }
      .bracket-round {
        min-height: auto;
        max-height: none;
      }
      .match {
        width: 140px;
        margin: 8px auto;
      }
      .match::after {
        display: none !important;
      }
      .bracket-final {
        padding: 0;
      }
      .bracket-final .match {
        width: 150px;
      }
    }
    
    @media (max-width: 480px) {
      .bracket-container {
        max-width: 97vw;
        min-width: unset;
        padding: 10px 2vw 15px 2vw;
      }
      .tournament-header h1 {
        font-size: 18px;
        margin-bottom: 15px;
      }
      .tournament-info {
        font-size: 13px;
        margin-bottom: 20px;
      }
      .bracket-side {
        flex-direction: column !important;
        gap: 15px;
      }
      .match {
        width: 100%;
        max-width: 200px;
      }
      .player {
        font-size: 10px;
        padding: 7px 8px;
      }
      .round-label {
        font-size: 11px;
        padding: 4px 6px;
      }
      .play-btn, .result-btn {
        font-size: 10px;
        padding: 6px;
      }
    }
  </style>
</head>
<body>
  <div class="video-background"></div>
  
  <!-- Home Button -->
  <a href="index.html" class="home-btn">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a>
  
  <div class="bracket-container">
    <div class="tournament-header">
      <h1>ÿ¨ÿØŸàŸÑ ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿßÿ™ - ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ŸÇÿµÿßÿ°</h1>
      <div class="tournament-info" id="tournamentInfo"></div>
    </div>
    
    <button class="draw-btn" id="drawBtn" onclick="performDraw()">ÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑŸÇÿ±ÿπÿ© ÿßŸÑÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©</button>
    
    <button class="draw-btn" id="leaderboardBtn" onclick="showTournamentLeaderboard()" style="background: linear-gradient(135deg, #4CAF50, #45a049); margin-bottom: 15px;">
      üèÜ ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ
    </button>
    
    <div id="bracket-content"></div>
  </div>
  <script>
    // ÿ¨ŸÑÿ® ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ
    console.log('Loading players from localStorage...');
    const playersData = localStorage.getItem('tournamentPlayerNames');
    console.log('Raw players data from localStorage:', playersData);
    
    let players = [];
    if(playersData) {
      try {
        players = JSON.parse(playersData);
        console.log('Parsed players:', players);
      } catch(e) {
        console.error('Error parsing players data:', e);
        players = [];
      }
    } else {
      console.log('No players data found in localStorage');
    }
    
    console.log('Final players array:', players);
    
    let tournamentData = {
      players: [...players],
      rounds: [],
      currentRound: 0,
      isDrawDone: false,
      matches: []
    };
    
    console.log('Initial tournament data:', tournamentData);

    // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿµŸÅÿ≠ÿ©
    function initializePage() {
      console.log('initializePage called');
      console.log('Players from localStorage:', players);
      
      // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©
      const bracketContent = document.getElementById('bracket-content');
      const drawBtn = document.getElementById('drawBtn');
      
      if (!bracketContent) {
        console.error('bracket-content element not found!');
        return;
      }
      
      if(!players.length){
        console.log('No players found, showing error message');
        bracketContent.innerHTML = `
          <div style="color:#fff;padding:28px;text-align:center;">
            <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿ≥ŸÖÿßÿ° ŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ</h3>
            <p>Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿπŸàÿØÿ© ŸÑÿ•ÿπÿØÿßÿØ ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿßÿ™ Ÿàÿ•ÿØÿÆÿßŸÑ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ</p>
            <a href="tournament-setup.html" style="color:#FF9800;text-decoration:none;font-size:18px;font-weight:bold;">‚Üê ÿßŸÑÿπŸàÿØÿ© ŸÑÿ•ÿπÿØÿßÿØ ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿßÿ™</a>
          </div>
        `;
        if (drawBtn) drawBtn.style.display = 'none';
        return;
      }
      
      console.log('Loading tournament data...');
      loadTournamentData();
      
      if(tournamentData.isDrawDone) {
        console.log('Draw already done, hiding draw button');
        if (drawBtn) drawBtn.style.display = 'none';
        processMatchResult();
        renderTournament();
      } else {
        console.log('Draw not done yet, showing draw button');
        renderTournament();
      }
    }

    // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ®ÿ∑ŸàŸÑÿ©
    function saveTournamentData() {
      localStorage.setItem('tournamentData', JSON.stringify(tournamentData));
    }

    // ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ®ÿ∑ŸàŸÑÿ©
    function loadTournamentData() {
      console.log('loadTournamentData called');
      const saved = localStorage.getItem('tournamentData');
      if(saved) {
        console.log('Found saved tournament data:', saved);
        tournamentData = JSON.parse(saved);
        console.log('Loaded tournament data:', tournamentData);
      } else {
        console.log('No saved tournament data found');
      }
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function getRoundLabel(roundNumber, totalRounds) {
      // ‚úÖ ÿ≠ÿ≥ÿßÿ® ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ£ÿØŸàÿßÿ± ÿ®ÿ¥ŸÉŸÑ ÿØŸäŸÜÿßŸÖŸäŸÉŸä ŸÖŸÜ ÿßŸÑŸÜŸáÿßŸäÿ©
      // ÿ¢ÿÆÿ± ÿØŸàÿ± = ÿßŸÑŸÜŸáÿßÿ¶Ÿä
      // ŸÇÿ®ŸÑ ÿßŸÑÿ£ÿÆŸäÿ± = ŸÜÿµŸÅ ÿßŸÑŸÜŸáÿßÿ¶Ÿä
      // ŸÇÿ®ŸÑ ŸÇÿ®ŸÑ ÿßŸÑÿ£ÿÆŸäÿ± = ÿ±ÿ®ÿπ ÿßŸÑŸÜŸáÿßÿ¶Ÿä
      // ŸàŸáŸÉÿ∞ÿß...
      
      const roundsFromEnd = totalRounds - roundNumber + 1;
      
      if (roundsFromEnd === 1) return 'ÿßŸÑŸÜŸáÿßÿ¶Ÿä';
      if (roundsFromEnd === 2) return 'ŸÜÿµŸÅ ÿßŸÑŸÜŸáÿßÿ¶Ÿä';
      if (roundsFromEnd === 3) return 'ÿ±ÿ®ÿπ ÿßŸÑŸÜŸáÿßÿ¶Ÿä';
      if (roundsFromEnd === 4) return 'ÿ´ŸÖŸÜ ÿßŸÑŸÜŸáÿßÿ¶Ÿä';
      if (roundsFromEnd === 5) return 'ÿØŸàÿ± ÿßŸÑŸÄ 32';
      if (roundsFromEnd === 6) return 'ÿØŸàÿ± ÿßŸÑŸÄ 64';
      if (roundsFromEnd === 7) return 'ÿØŸàÿ± ÿßŸÑŸÄ 128';
      
      // ŸÑŸÑÿ£ÿØŸàÿßÿ± ÿßŸÑÿ£ŸÉÿ®ÿ±ÿå ÿßÿ≠ÿ≥ÿ® ÿπÿØÿØ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿØŸàÿ±
      const playersInRound = Math.pow(2, roundsFromEnd);
      return `ÿØŸàÿ± ÿßŸÑŸÄ ${playersInRound}`;
    }

    function calculateRounds(playerCount) {
      let rounds = [];
      let currentCount = playerCount;
      let roundNumber = 1;
      
      // ‚úÖ ÿ≠ÿ≥ÿßÿ® ÿ•ÿ¨ŸÖÿßŸÑŸä ÿπÿØÿØ ÿßŸÑÿ£ÿØŸàÿßÿ± ÿ£ŸàŸÑÿßŸã
      let tempCount = playerCount;
      let totalRounds = 0;
      while(tempCount > 1) {
        totalRounds++;
        tempCount = Math.ceil(tempCount / 2);
      }
      
      // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ£ÿØŸàÿßÿ± ŸÖÿπ ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©
      while(currentCount > 1) {
        rounds.push({
          round: roundNumber,
          name: getRoundLabel(roundNumber, totalRounds),
          playerCount: currentCount,
          matchCount: Math.floor(currentCount / 2),
          matches: []
        });
        currentCount = Math.ceil(currentCount / 2);
        roundNumber++;
      }
      
      return rounds;
    }

    function performDraw() {
      console.log('performDraw called');
      
      if(tournamentData.isDrawDone) {
        alert('ÿ™ŸÖ ÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑŸÇÿ±ÿπÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã!');
        return;
      }

      if(tournamentData.players.length < 2) {
        alert('Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸáŸÜÿßŸÉ ŸÑÿßÿπÿ®ŸäŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÑÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑŸÇÿ±ÿπÿ©!');
        return;
      }

      console.log('Starting draw with players:', tournamentData.players);

      // ÿÆŸÑÿ∑ ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° ÿπÿ¥Ÿàÿßÿ¶ŸäÿßŸã
      shuffle(tournamentData.players);
      console.log('Shuffled players:', tournamentData.players);
      
      // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ£ÿØŸàÿßÿ±
      tournamentData.rounds = calculateRounds(tournamentData.players.length);
      console.log('Calculated rounds:', tournamentData.rounds);
      
      // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿßÿ™ ŸÑŸÑÿØŸàÿ± ÿßŸÑÿ£ŸàŸÑ
      createFirstRoundMatches();
      console.log('Created first round matches:', tournamentData.rounds[0].matches);
      
      tournamentData.isDrawDone = true;
      tournamentData.currentRound = 1;
      
      saveTournamentData();
      renderTournament();
      
      const drawBtn = document.getElementById('drawBtn');
      if (drawBtn) {
        drawBtn.style.display = 'none';
      }
      
      console.log('Draw completed successfully');
    }

    function createFirstRoundMatches() {
      const firstRound = tournamentData.rounds[0];
      firstRound.matches = [];
      
      for(let i = 0; i < tournamentData.players.length; i += 2) {
        const match = {
          id: `r1-m${Math.floor(i/2)}`,
          player1: tournamentData.players[i],
          player2: tournamentData.players[i + 1] || null,
          winner: null,
          status: 'pending', // pending, playing, completed
          result: null
        };
        firstRound.matches.push(match);
      }
    }

    function renderTournament() {
      console.log('renderTournament called - Mirror Horizontal Style');
      
      const content = document.getElementById('bracket-content');
      if (!content) {
        console.error('bracket-content element not found!');
        return;
      }
      content.innerHTML = '';
      
      // ÿπÿ±ÿ∂ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ®ÿ∑ŸàŸÑÿ©
      const tournamentInfo = document.getElementById('tournament-info');
      if (tournamentInfo) {
        tournamentInfo.innerHTML = 
          `ÿπÿØÿØ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ: ${tournamentData.players.length} | ÿßŸÑÿ£ÿØŸàÿßÿ±: ${tournamentData.rounds.length}`;
      } else {
        console.warn('tournament-info element not found');
      }

      if(tournamentData.rounds.length === 0) {
        content.innerHTML = '<div style="color:#fff;padding:28px;text-align:center;">ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "ÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑŸÇÿ±ÿπÿ© ÿßŸÑÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©" ŸÑÿ®ÿØÿ° ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿßÿ™</div>';
        return;
      }

      const totalRounds = tournamentData.rounds.length;
      
      if (totalRounds === 1) {
        // ÿπÿ±ÿ∂ ÿßŸÑŸÜŸáÿßÿ¶Ÿä ŸÅŸÇÿ∑ ŸÅŸä ÿßŸÑŸÖŸÜÿ™ÿµŸÅ
        const finalContainer = document.createElement('div');
        finalContainer.className = 'bracket-final';
        
        const roundColumn = createRoundColumn(tournamentData.rounds[0], 0);
        finalContainer.appendChild(roundColumn);
        content.appendChild(finalContainer);
        return;
      }

      // Left side - ŸÖŸÜ ÿßŸÑÿØŸàÿ± ÿßŸÑÿ£ŸàŸÑ ÿ≠ÿ™Ÿâ ŸÖÿß ŸÇÿ®ŸÑ ÿßŸÑŸÜŸáÿßÿ¶Ÿä (ÿ®ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®)
      const leftSide = document.createElement('div');
      leftSide.className = 'bracket-side left';
      
      // ŸÜÿ∂ÿπ ŸÉŸÑ ÿßŸÑÿ£ÿØŸàÿßÿ± ŸÖÿß ÿπÿØÿß ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿå ŸàŸÑŸÉŸÜ ŸÜÿπÿ±ÿ∂ ŸÜÿµŸÅ ÿßŸÑŸÖÿ®ÿßÿ±Ÿäÿßÿ™ ŸÅŸÇÿ∑
      for (let i = 0; i < totalRounds - 1; i++) {
        const round = tournamentData.rounds[i];
        const topMatches = splitMatchesInHalf(round.matches, true);
        const leftRound = { ...round, matches: topMatches };
        const roundColumn = createRoundColumn(leftRound, i);
        leftSide.appendChild(roundColumn);
      }
      
      content.appendChild(leftSide);
      
      // Final in center
      const finalContainer = document.createElement('div');
      finalContainer.className = 'bracket-final';
      const finalRound = tournamentData.rounds[totalRounds - 1];
      const finalColumn = createRoundColumn(finalRound, totalRounds - 1);
      finalContainer.appendChild(finalColumn);
      content.appendChild(finalContainer);
      
      // Right side - ŸÖÿ±ÿ¢ÿ© ÿßŸÑÿ¨ÿßŸÜÿ® ÿßŸÑÿ£Ÿäÿ≥ÿ± (ÿßŸÑŸÜÿµŸÅ ÿßŸÑÿ≥ŸÅŸÑŸä ŸÖŸÜ ÿßŸÑŸÖÿ®ÿßÿ±Ÿäÿßÿ™)
      const rightSide = document.createElement('div');
      rightSide.className = 'bracket-side right';
      
      for (let i = 0; i < totalRounds - 1; i++) {
        const round = tournamentData.rounds[i];
        const bottomMatches = splitMatchesInHalf(round.matches, false);
        const rightRound = { ...round, matches: bottomMatches };
        const roundColumn = createRoundColumn(rightRound, i);
        rightSide.appendChild(roundColumn);
      }
      
      content.appendChild(rightSide);
      
      console.log('Tournament rendered successfully in mirror horizontal style');
    }
    
    function splitMatchesInHalf(matches, isTopHalf) {
      const mid = Math.ceil(matches.length / 2);
      return isTopHalf ? matches.slice(0, mid) : matches.slice(mid);
    }
    
    function createRoundColumn(round, roundIndex) {
      const roundColumn = document.createElement('div');
      roundColumn.className = 'bracket-round';
      
      // Add round label
      const roundLabel = document.createElement('div');
      roundLabel.className = 'round-label';
      roundLabel.textContent = round.name;
      roundColumn.appendChild(roundLabel);
      
      // Add matches container
      const matchesContainer = document.createElement('div');
      matchesContainer.style.cssText = 'flex: 1; display: flex; flex-direction: column; justify-content: space-around;';
      
      // If no matches yet, show waiting message
      if(!round.matches || round.matches.length === 0) {
        const waitingDiv = document.createElement('div');
        waitingDiv.className = 'match';
        waitingDiv.style.cssText = 'opacity: 0.5; border-style: dashed;';
        waitingDiv.innerHTML = `
          <div class="player" style="padding: 20px; font-size: 12px; color: #aaa;">
            ŸÅŸä ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑŸÅÿßÿ¶ÿ≤ŸäŸÜ<br>ŸÖŸÜ ÿßŸÑÿ£ÿØŸàÿßÿ± ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
          </div>
        `;
        matchesContainer.appendChild(waitingDiv);
      } else {
        round.matches.forEach((match, matchIndex) => {
          const matchDiv = document.createElement('div');
          matchDiv.className = 'match';
          matchDiv.id = match.id;
          
          if(match.status === 'completed') {
            matchDiv.classList.add('completed');
          } else if(match.status === 'playing') {
            matchDiv.classList.add('current');
          }
          
          if(match.player2) {
            matchDiv.innerHTML = `
              <div class="player ${match.winner === match.player1 ? 'winner' : (match.winner ? 'loser' : '')}">${match.player1}</div>
              <div class="player ${match.winner === match.player2 ? 'winner' : (match.winner ? 'loser' : '')}">${match.player2}</div>
              ${match.status === 'pending' ? `<button class="play-btn" onclick="playMatch('${match.id}')">ŸÑÿπÿ®</button>` : ''}
              ${match.status === 'completed' ? `<button class="result-btn" onclick="showMatchResult('${match.id}')">ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©</button>` : ''}
            `;
          } else {
            matchDiv.innerHTML = `
              <div class="player winner">${match.player1}<br><small>(ÿ™ÿ£ŸáŸÑ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã)</small></div>
            `;
          }
          
          matchesContainer.appendChild(matchDiv);
        });
      }
      
      roundColumn.appendChild(matchesContainer);
      return roundColumn;
    }

    // ‚úÖ ŸÖÿ≥ÿ≠ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ© ÿπŸÜÿØ ÿ®ÿØÿ° ŸÖÿ®ÿßÿ±ÿßÿ© ÿ¨ÿØŸäÿØÿ©
    function clearPreviousMatchData() {
      console.log('üßπ Clearing previous match data...');
      
      // ŸÖÿ≥ÿ≠ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ŸÖŸÜ ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
      localStorage.removeItem('player1StrategicOrdered');
      localStorage.removeItem('player2StrategicOrdered');
      localStorage.removeItem('player1Order');
      localStorage.removeItem('player2Order');
      
      // ŸÖÿ≥ÿ≠ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®
      localStorage.removeItem('player1ArrangementCompleted');
      localStorage.removeItem('player2ArrangementCompleted');
      localStorage.removeItem('player1CardArrangement');
      localStorage.removeItem('player2CardArrangement');
      
      // ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ© ÿßŸÑŸÇÿØŸäŸÖÿ© (ÿ≥Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ±Ÿáÿß ŸÖŸÜ ÿ¨ÿØŸäÿØ)
      localStorage.removeItem('player1StrategicPicks');
      localStorage.removeItem('player2StrategicPicks');
      
      // ŸÖÿ≥ÿ≠ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÑÿπÿ®ÿ© ÿßŸÑŸÇÿØŸäŸÖÿ©
      localStorage.removeItem('currentRound');
      localStorage.removeItem('battleStarted');
      
      // ŸÖÿ≥ÿ≠ ÿßŸÑŸÇÿØÿ±ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿ© ŸÖŸÜ ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
      localStorage.removeItem('player1UsedAbilities');
      localStorage.removeItem('player2UsedAbilities');
      localStorage.removeItem('usedAbilities');
      localStorage.removeItem('abilityRequests');
      
      // ŸÖÿ≥ÿ≠ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÇÿØÿ±ÿßÿ™ ŸÑÿ•ÿπÿßÿØÿ© ÿ™ŸáŸäÿ¶ÿ™Ÿáÿß ŸÖŸÜ ÿ¨ÿØŸäÿØ
      localStorage.removeItem('player1Abilities');
      localStorage.removeItem('player2Abilities');
      
      console.log('‚úÖ Previous match data cleared (including abilities)');
    }

    function playMatch(matchId) {
      // ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ©
      let match = null;
      let roundIndex = -1;
      
      for(let i = 0; i < tournamentData.rounds.length; i++) {
        const foundMatch = tournamentData.rounds[i].matches.find(m => m.id === matchId);
        if(foundMatch) {
          match = foundMatch;
          roundIndex = i;
          break;
        }
      }
      
      if(!match) return;
      
      // ‚úÖ ŸÖÿ≥ÿ≠ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ© ŸÇÿ®ŸÑ ÿ®ÿØÿ° ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
      clearPreviousMatchData();
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ©
      match.status = 'playing';
      tournamentData.currentMatch = matchId;
      
      // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ ŸÑŸÑŸÖÿ®ÿßÿ±ÿßÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
      localStorage.setItem('currentMatchPlayers', JSON.stringify([match.player1, match.player2]));
      localStorage.setItem('currentMatchId', matchId);
      
      saveTournamentData();
      
      // ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ ÿµŸÅÿ≠ÿ© ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ¨ŸàŸÑÿßÿ™
      window.location.href = 'tournament-rounds.html';
    }

    function showMatchResult(matchId) {
      // ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© Ÿàÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©
      let match = null;
      for(let i = 0; i < tournamentData.rounds.length; i++) {
        const foundMatch = tournamentData.rounds[i].matches.find(m => m.id === matchId);
        if(foundMatch) {
          match = foundMatch;
          break;
        }
      }
      
      if(match && match.winner) {
        alert(`ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: ${match.winner} ŸÅÿßÿ≤ ÿπŸÑŸâ ${match.winner === match.player1 ? match.player2 : match.player1}`);
      }
    }

    // ÿØÿßŸÑÿ© ŸÑŸÖÿπÿßŸÑÿ¨ÿ© ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖÿ®ÿßÿ±Ÿäÿßÿ™ ÿπŸÜÿØ ÿßŸÑÿπŸàÿØÿ© ŸÖŸÜ ÿµŸÅÿ≠ÿ© ÿßŸÑŸÑÿπÿ®
    function processMatchResult() {
      const matchId = localStorage.getItem('currentMatchId');
      const winner = localStorage.getItem('matchWinner');
      
      if(matchId && winner) {
        // Check if it's a draw that needs replay
        if(winner === 'DRAW_REPLAY') {
          console.log('‚ö†Ô∏è Draw detected - match will be replayed');
          
          // Find the match and reset it to pending status
          for(let i = 0; i < tournamentData.rounds.length; i++) {
            const match = tournamentData.rounds[i].matches.find(m => m.id === matchId);
            if(match) {
              // Reset match to pending (will be replayed)
              match.status = 'pending';
              match.winner = null;
              match.result = null;
              console.log(`Match ${matchId} reset for replay`);
              break;
            }
          }
          
          // Clear all match data to ensure fresh start for replay
          clearPreviousMatchData();
          
          // Clear temporary data
          localStorage.removeItem('currentMatchId');
          localStorage.removeItem('matchWinner');
          localStorage.removeItem('currentMatchPlayers');
          
          saveTournamentData();
          renderTournament();
          
          // Show alert to inform players
          alert('‚ö†Ô∏è ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© ÿßŸÜÿ™Ÿáÿ™ ÿ®ÿßŸÑÿ™ÿπÿßÿØŸÑ!\n\nŸäÿ¨ÿ® ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© ÿ≠ÿ™Ÿâ ŸäŸÅŸàÿ≤ ÿ£ÿ≠ÿØ ÿßŸÑÿ∑ÿ±ŸÅŸäŸÜ.\n\nÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© ÿ¨ÿßŸáÿ≤ÿ© ŸÑŸÑÿ®ÿØÿ° ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
          
        } else {
          // Normal win - ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿ®ÿßÿ±ÿßÿ© Ÿàÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©
          for(let i = 0; i < tournamentData.rounds.length; i++) {
            const match = tournamentData.rounds[i].matches.find(m => m.id === matchId);
            if(match) {
              match.winner = winner;
              match.status = 'completed';
              match.result = winner;
              
              // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÑŸäÿØÿ± ÿ®Ÿàÿ±ÿØ
              updateLeaderboard(winner, match.player1 === winner ? match.player2 : match.player1);
              
              // ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑÿØŸàÿ± ÿßŸÑÿ™ÿßŸÑŸä ÿ•ÿ∞ÿß ÿßŸÜÿ™Ÿáÿ™ ÿ¨ŸÖŸäÿπ ŸÖÿ®ÿßÿ±Ÿäÿßÿ™ Ÿáÿ∞ÿß ÿßŸÑÿØŸàÿ±
              checkRoundCompletion(i);
              break;
            }
          }
          
          // ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©
          localStorage.removeItem('currentMatchId');
          localStorage.removeItem('matchWinner');
          localStorage.removeItem('currentMatchPlayers');
          
          saveTournamentData();
          renderTournament();
        }
      }
    }

    function updateLeaderboard(winner, loser) {
      let leaderboard = JSON.parse(localStorage.getItem('tournamentLeaderboard')) || [];
      
      // Find or create winner
      let winnerObj = leaderboard.find(p => p.name === winner);
      if (!winnerObj) {
        winnerObj = { name: winner, wins: 0, losses: 0, games: 0, points: 0, winRate: 0 };
        leaderboard.push(winnerObj);
      }
      winnerObj.wins++;
      winnerObj.games++;
      winnerObj.points += 3; // 3 points per win
      winnerObj.winRate = Math.round((winnerObj.wins / winnerObj.games) * 100);
      
      // Find or create loser
      let loserObj = leaderboard.find(p => p.name === loser);
      if (!loserObj) {
        loserObj = { name: loser, wins: 0, losses: 0, games: 0, points: 0, winRate: 0 };
        leaderboard.push(loserObj);
      }
      loserObj.losses++;
      loserObj.games++;
      loserObj.winRate = Math.round((loserObj.wins / loserObj.games) * 100);
      
      // Sort leaderboard
      leaderboard.sort((a, b) => {
        if (b.points !== a.points) return b.points - a.points;
        if (b.winRate !== a.winRate) return b.winRate - a.winRate;
        return b.wins - a.wins;
      });
      
      localStorage.setItem('tournamentLeaderboard', JSON.stringify(leaderboard));
      console.log(`ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ: ${winner} ŸÅÿßÿ≤ ÿπŸÑŸâ ${loser}`);
    }

    function checkRoundCompletion(roundIndex) {
      const round = tournamentData.rounds[roundIndex];
      const allCompleted = round.matches.every(match => match.status === 'completed');
      
      if(allCompleted && roundIndex < tournamentData.rounds.length - 1) {
        // ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ®ÿßÿ±Ÿäÿßÿ™ ÿßŸÑÿØŸàÿ± ÿßŸÑÿ™ÿßŸÑŸä
        createNextRoundMatches(roundIndex + 1);
        saveTournamentData();
        renderTournament();
        console.log(`‚úÖ Created next round matches for round ${roundIndex + 1}`);
      } else if(allCompleted && roundIndex === tournamentData.rounds.length - 1) {
        // ÿßŸÑÿ®ÿ∑ŸàŸÑÿ© ÿßŸÜÿ™Ÿáÿ™
        showTournamentWinner();
      }
    }

    function createNextRoundMatches(nextRoundIndex) {
      const currentRound = tournamentData.rounds[nextRoundIndex - 1];
      const nextRound = tournamentData.rounds[nextRoundIndex];
      
      nextRound.matches = [];
      const winners = currentRound.matches.map(match => match.winner).filter(winner => winner);
      
      for(let i = 0; i < winners.length; i += 2) {
        const match = {
          id: `r${nextRoundIndex + 1}-m${Math.floor(i/2)}`,
          player1: winners[i],
          player2: winners[i + 1] || null,
          winner: null,
          status: 'pending',
          result: null
        };
        nextRound.matches.push(match);
      }
    }

    function showTournamentWinner() {
      const finalRound = tournamentData.rounds[tournamentData.rounds.length - 1];
      const winner = finalRound.matches[0].winner;
      
      document.getElementById('bracket-content').innerHTML = `
        <div class="final">
          üèÜ ÿßŸÑŸÅÿßÿ¶ÿ≤ üèÜ<br>
          <span style="color:gold;font-size:32px;">${winner}</span>
        </div>
      `;
    }
    
    // Show tournament leaderboard
    function showTournamentLeaderboard() {
      console.log('showTournamentLeaderboard called');
      const leaderboard = getTournamentLeaderboard();
      console.log('Tournament Leaderboard data:', leaderboard);
      
      const overlay = document.createElement('div');
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('images/QG14Background.png') center/cover no-repeat, #8B1538;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        font-family: "Cairo", sans-serif;
        padding: 0;
      `;
      
      overlay.innerHTML = `
        <style>
          @keyframes fadeInUp {
            from {
              opacity: 0;
              transform: translateY(30px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
          
          .leaderboard-row {
            animation: fadeInUp 0.6s ease-out;
          }
          
          .leaderboard-row:nth-child(1) { animation-delay: 0.1s; }
          .leaderboard-row:nth-child(2) { animation-delay: 0.2s; }
          .leaderboard-row:nth-child(3) { animation-delay: 0.3s; }
          .leaderboard-row:nth-child(4) { animation-delay: 0.4s; }
          .leaderboard-row:nth-child(5) { animation-delay: 0.5s; }
        </style>
        <div style="
          background: transparent;
          color: white;
          width: 96vw;
          height: 96vh;
          border-radius: 0;
          overflow: hidden;
          font-family: 'Cairo', sans-serif;
          position: relative;
          display: flex;
          flex-direction: column;
        ">
          
          <!-- Title -->
          <div style="
            background: transparent;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
          ">
            <h1 style="
              margin: 0; 
              font-size: 28px; 
              font-weight: 700; 
              color: white;
              letter-spacing: 1px;
              text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            ">
              ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ - ÿßŸÑÿ®ÿ∑ŸàŸÑÿ©
            </h1>
          </div>
          
          <!-- Top 3 Podium -->
          <div style="
            background: transparent;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 30px;
            margin-bottom: 20px;
          ">
            <!-- 2nd Place -->
            <div style="
              display: flex;
              flex-direction: column;
              align-items: center;
              gap: 10px;
            ">
              <div style="
                width: 70px;
                height: 70px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 22px;
                color: white;
                background: linear-gradient(135deg, #C0C0C0, #808080);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
                border: 3px solid #C0C0C0;
              ">
                2
              </div>
              <div style="
                color: white;
                font-weight: bold;
                font-size: 14px;
                text-align: center;
                max-width: 100px;
              ">
                ${leaderboard.length >= 2 ? leaderboard[1].name : '---'}
              </div>
              <div style="
                color: #FFD700;
                font-weight: bold;
                font-size: 12px;
              ">
                ${leaderboard.length >= 2 ? leaderboard[1].points + ' ŸÜŸÇÿ∑ÿ©' : '0 ŸÜŸÇÿ∑ÿ©'}
              </div>
            </div>
            
            <!-- 1st Place -->
            <div style="
              display: flex;
              flex-direction: column;
              align-items: center;
              gap: 10px;
            ">
              <div style="
                width: 90px;
                height: 90px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 28px;
                color: white;
                background: linear-gradient(135deg, #FFD700, #FFA500);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
                border: 4px solid #FFD700;
              ">
                1
              </div>
              <div style="
                color: white;
                font-weight: bold;
                font-size: 16px;
                text-align: center;
                max-width: 120px;
              ">
                ${leaderboard.length >= 1 ? leaderboard[0].name : '---'}
              </div>
              <div style="
                color: #FFD700;
                font-weight: bold;
                font-size: 14px;
              ">
                ${leaderboard.length >= 1 ? leaderboard[0].points + ' ŸÜŸÇÿ∑ÿ©' : '0 ŸÜŸÇÿ∑ÿ©'}
              </div>
            </div>
            
            <!-- 3rd Place -->
            <div style="
              display: flex;
              flex-direction: column;
              align-items: center;
              gap: 10px;
            ">
              <div style="
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 18px;
                color: white;
                background: linear-gradient(135deg, #CD7F32, #8B4513);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
                border: 3px solid #CD7F32;
              ">
                3
              </div>
              <div style="
                color: white;
                font-weight: bold;
                font-size: 12px;
                text-align: center;
                max-width: 90px;
              ">
                ${leaderboard.length >= 3 ? leaderboard[2].name : '---'}
              </div>
              <div style="
                color: #FFD700;
                font-weight: bold;
                font-size: 11px;
              ">
                ${leaderboard.length >= 3 ? leaderboard[2].points + ' ŸÜŸÇÿ∑ÿ©' : '0 ŸÜŸÇÿ∑ÿ©'}
              </div>
            </div>
          </div>
          
          <!-- Table Container -->
          <div style="
            flex: 1; 
            overflow-y: auto; 
            padding: 20px;
            max-height: 60vh;
            position: relative;
          " 
          id="leaderboardTableContainer">
            <table style="
              width: 100%;
              border-collapse: collapse;
              background: rgba(107, 15, 42, 0.7);
              color: white;
              font-size: 14px;
              border-radius: 8px;
              overflow: hidden;
            ">
              <thead>
                <tr style="background: rgba(90, 13, 36, 0.8);">
                  <th style="padding: 15px 3px; text-align: center; border-bottom: 1px solid #FFD700; color: white; font-weight: bold;">#</th>
                  <th style="padding: 15px 3px; text-align: right; border-bottom: 1px solid #FFD700; color: white; font-weight: bold;">ÿßÿ≥ŸÖ ÿßŸÑŸÑÿßÿπÿ®</th>
                  <th style="padding: 15px 3px; text-align: center; border-bottom: 1px solid #FFD700; color: white; font-weight: bold;">ÿπÿØÿØ ÿßŸÑŸÖÿ®ÿßÿ±Ÿäÿßÿ™</th>
                  <th style="padding: 15px 3px; text-align: center; border-bottom: 1px solid #FFD700; color: white; font-weight: bold;">ŸÅÿßÿ≤</th>
                  <th style="padding: 15px 3px; text-align: center; border-bottom: 1px solid #FFD700; color: white; font-weight: bold;">ÿÆÿ≥ÿ±</th>
                  <th style="padding: 15px 3px; text-align: center; border-bottom: 1px solid #FFD700; color: white; font-weight: bold;">ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÅŸàÿ≤</th>
                  <th style="padding: 15px 3px; text-align: center; border-bottom: 1px solid #FFD700; color: white; font-weight: bold;">ŸÜŸÇÿßÿ∑</th>
                </tr>
              </thead>
              <tbody id="leaderboardTableBody">
                ${leaderboard.length === 0 ? 
                  '<tr><td colspan="7" style="padding: 40px; text-align: center; color: #ccc; font-size: 18px;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ÿ®ÿπÿØ. ÿßÿ®ÿØÿ£ ÿßŸÑŸÑÿπÿ®!</td></tr>' :
                  leaderboard.map((player, index) => `
                    <tr class="leaderboard-row" style="
                      border-bottom: 1px solid #4A0A1A;
                      background: ${index % 2 === 0 ? 'rgba(107, 15, 42, 0.6)' : 'rgba(90, 13, 36, 0.6)'};
                    ">
                      <td style="padding: 15px 3px; text-align: center; font-weight: bold; color: white;">${index + 1}</td>
                      <td style="padding: 15px 3px; text-align: right; font-weight: bold; font-size: 16px; color: white;">${player.name}</td>
                      <td style="padding: 15px 3px; text-align: center; color: white;">${player.games || 0}</td>
                      <td style="padding: 15px 3px; text-align: center; color: #4CAF50; font-weight: bold;">${player.wins || 0}</td>
                      <td style="padding: 15px 3px; text-align: center; color: #f44336; font-weight: bold;">${player.losses || 0}</td>
                      <td style="padding: 15px 3px; text-align: center; font-weight: bold; color: white;">${player.winRate || 0}%</td>
                      <td style="padding: 15px 3px; text-align: center; color: white; font-weight: bold; font-size: 16px;">${player.points || 0}</td>
                    </tr>
                  `).join('')
                }
              </tbody>
            </table>
          </div>
          
          <!-- Footer -->
          <div style="
            background: transparent;
            padding: 20px;
            text-align: center;
          ">
            <button id="closeLeaderboardBtn" style="
              background: #FFD700;
              color: #000;
              border: none;
              border-radius: 8px;
              padding: 12px 24px;
              font-size: 16px;
              font-weight: bold;
              cursor: pointer;
              font-family: 'Cairo', sans-serif;
              transition: all 0.3s ease;
            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
              ÿ•ÿ∫ŸÑÿßŸÇ
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(overlay);
      
      // Close button handler
      document.getElementById('closeLeaderboardBtn').addEventListener('click', function() {
        document.body.removeChild(overlay);
      });
      
      // Close on ESC key
      const handleEscape = function(e) {
        if (e.key === 'Escape') {
          document.body.removeChild(overlay);
          document.removeEventListener('keydown', handleEscape);
        }
      };
      document.addEventListener('keydown', handleEscape);
    }
    
    // Get tournament leaderboard data
    function getTournamentLeaderboard() {
      const leaderboardData = localStorage.getItem('tournamentLeaderboard');
      if (!leaderboardData) {
        return [];
      }
      
      const players = JSON.parse(leaderboardData);
      return players.sort((a, b) => {
        // Sort by points first, then by win rate, then by wins
        if (b.points !== a.points) return b.points - a.points;
        if (b.winRate !== a.winRate) return b.winRate - a.winRate;
        return b.wins - a.wins;
      });
    }


    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ŸáŸäÿ¶ÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
    document.addEventListener('DOMContentLoaded', initializePage);
    
    // ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÅŸàÿ±Ÿä ŸÅŸä ÿ≠ÿßŸÑÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializePage);
    } else {
      initializePage();
    }

  </script>
</body>
</html>
